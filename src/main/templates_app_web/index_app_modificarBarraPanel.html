<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <link rel="icon" type="image/svg+xml" th:href="@{/img/rahip-logo-blanco.svg}" /> 

    <title>BartenderStock - Detalles de Barra</title>

    <style>
        /* ESTILOS GENERALES Y RESET (Idénticos al index_app.html principal) */
        :root {
            --primary-color: #6f42c1;
            --primary-color-darker: #5a34a7;
            --secondary-color: blueviolet;
            --light-grey: #f3f3f3;
            --dark-grey: #333;
            --text-color-light: #ffffff;
            --text-color-dark: #333333;
            --sidebar-bg: #4e2a8e;
            --content-bg: #f9f9f9;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
            --success-bg: #d4edda; /* Para mensajes de éxito */
            --success-text: #155724;
            --success-border: #c3e6cb;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background-color: var(--primary-color); color: var(--text-color-dark); overflow-x: hidden; }
        a { text-decoration: none; color: var(--primary-color-darker); }
        a:hover { color: var(--secondary-color); }
        img { max-width: 100%; height: auto; }

        /* --- ESTRUCTURA PRINCIPAL (Idéntica) --- */
        #app-container { display: flex; min-height: 100vh; }

        /* --- SIDEBAR (Idéntico) --- */
        #sidebar {
            background: var(--sidebar-bg); color: var(--text-color-light); width: 280px;
            position: fixed; top: 0; left: 0; height: 100%; overflow-y: auto;
            z-index: 1000; transition: width 0.3s ease;
        }
        #sidebar.hide { width: 60px; }
        #sidebar.hide .text, #sidebar.hide .brand .text { display: none; }
        #sidebar.hide .brand i, #sidebar.hide .side-menu a i { margin-right: 0; }
        #sidebar .brand {
            font-size: 24px; font-weight: 700; height: 64px; display: flex;
            align-items: center; justify-content: center; color: var(--text-color-light);
            padding: 0 10px; gap: 10px;
        }
        #sidebar .brand .bx { min-width: 40px; display: flex; justify-content: center; align-items: center; font-size: 28px; }
        #sidebar .side-menu { list-style: none; padding: 0; margin: 0; width: 100%; }
        #sidebar .side-menu a {
            display: flex; align-items: center; padding: 12px 20px;
            color: var(--text-color-light); font-size: 16px; white-space: nowrap;
            border-left: 3px solid transparent; transition: background 0.3s ease, border-left-color 0.3s ease;
        }
        #sidebar .side-menu a:hover, #sidebar .side-menu li.active > a {
            background: var(--primary-color-darker); border-left-color: var(--secondary-color);
        }
        #sidebar .side-menu a .bx, #sidebar .side-menu a .fas { /* Incluir .fas para Font Awesome */
            margin-right: 15px; font-size: 20px; min-width: 20px; text-align: center; 
        }
        #sidebar .side-menu .logout a { color: #f36d6d; }
        #sidebar .side-menu .logout a:hover { background: #c83a3a; color: white; }

        /* --- ÁREA DE CONTENIDO (Idéntica) --- */
        #content {
            position: relative; width: calc(100% - 280px); margin-left: 280px;
            transition: width 0.3s ease, margin-left 0.3s ease;
            background-color: var(--content-bg); min-height: 100vh; padding-bottom: 20px;
        }
        #sidebar.hide + #content { width: calc(100% - 60px); margin-left: 60px; }

        /* NAVBAR SUPERIOR (Idéntica) */
        #content nav {
            height: 64px; background: var(--card-bg); padding: 0 24px;
            display: flex; align-items: center; gap: 24px; position: sticky;
            top: 0; z-index: 900; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        #content nav .bx.bx-menu { cursor: pointer; font-size: 24px; color: var(--text-color-dark); }
        #content nav .nav-link { color: var(--text-color-dark); font-size: 16px; }
        #content nav form { flex-grow: 1; margin-right: auto; }
        #content nav .form-input {
            display: flex; align-items: center; background: var(--light-grey);
            border-radius: 20px; overflow: hidden; max-width: 350px;
        }
        #content nav .form-input input {
            border: none; background: transparent; padding: 10px 15px;
            outline: none; width: 100%; color: var(--text-color-dark);
        }
        #content nav .form-input .search-btn {
            background: var(--primary-color); color: white; border: none; padding: 0 12px;
            height: 36px; border-radius: 0 20px 20px 0; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        #content nav .form-input .search-btn .bx { font-size: 18px; }
        #content nav .switch-mode {
            display: block; min-width: 50px; height: 25px; background: var(--light-grey);
            cursor: pointer; position: relative; border-radius: 25px;
        }
        #content nav .switch-mode::before {
            content: ''; position: absolute; top: 2px; left: 2px; bottom: 2px;
            width: calc(25px - 4px); background: var(--primary-color);
            border-radius: 50%; transition: all .3s ease;
        }
        #content nav #switch-mode:checked + .switch-mode::before { left: calc(100% - (25px - 4px) - 2px); }
        #content nav .notification, #content nav .profile img { font-size: 20px; color: var(--text-color-dark); position: relative; }
        #content nav .notification .num {
            position: absolute; top: -6px; right: -6px; width: 20px; height: 20px;
            border-radius: 50%; background: #e74c3c; color: white; font-weight: 700;
            font-size: 10px; display: flex; justify-content: center; align-items: center;
        }
        #content nav .profile img { width: 36px; height: 36px; object-fit: cover; border-radius: 50%; border: 2px solid var(--primary-color); }

        /* --- MAIN CONTENT AREA (adaptado para esta página) --- */
        #content main { padding: 24px; width: 100%; }
        
        /* Mensaje de éxito */
        .success-alert {
            background-color: var(--success-bg);
            color: var(--success-text);
            border: 1px solid var(--success-border);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .success-alert .card-title { /* Thymeleaf original usaba .card-title */
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* Contenedor para cada sección de tabla */
         .table-section-card { 
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            margin-bottom: 30px; 
        }
        .table-section-card .head {
            display: flex; align-items: center; gap: 16px; margin-bottom: 20px;
        }
        .table-section-card .head h1, .table-section-card .head h3 { /* h1 o h3 para títulos de sección */
            margin-right: auto; font-size: 22px; font-weight: 600; color: var(--text-color-dark);
        }
        .table-section-card .head .bx, .table-section-card .head .fas { 
            cursor: pointer; font-size: 20px; color: #666; 
        }
        .table-section-card table { width: 100%; border-collapse: collapse; }
        .table-section-card th,
        .table-section-card td {
            border-bottom: 1px solid var(--border-color); padding: 12px 10px;
            font-size: 14px; text-align: left; vertical-align: middle;
        }
        .table-section-card th { font-weight: 600; background-color: var(--light-grey); color: var(--text-color-dark); }
        .table-section-card td img {
            width: 40px; /* Ajuste de tamaño de imagen en tabla */
            height: 40px; 
            border-radius: 50%; object-fit: cover;
            margin-right: 10px; 
        }
        .table-section-card td .action-icon { /* Para iconos de acción */
            font-size: 18px;
            color: var(--primary-color);
            margin: 0 5px; /* Espacio entre iconos si hay varios */
        }
        .table-section-card td .action-icon:hover { color: var(--primary-color-darker); }
        
        /* Botón para volver al Dashboard Principal */
        .btn-dashboard-link {
            display: inline-block; background: var(--secondary-color); color: white;
            padding: 10px 20px; border-radius: 20px; font-weight: 600;
            margin-bottom: 20px; transition: background-color 0.3s ease;
        }
        .btn-dashboard-link:hover { background: var(--primary-color-darker); color: white; }
        .btn-dashboard-link .bx { margin-right: 8px; vertical-align: middle; }


        /* RESPONSIVIDAD (BÁSICA - Idéntica) */
        @media screen and (max-width: 768px) {
            #sidebar { width: 60px; }
            #sidebar .text, #sidebar .brand .text { display: none; }
            #sidebar .brand i, #sidebar .side-menu a i { margin-right: 0; }
            #content { width: calc(100% - 60px); margin-left: 60px; }
            #content nav .form-input { display: none; }
        }
        @media screen and (max-width: 576px) {
            #content nav .nav-link { display:none; }
            #content nav .profile { margin-left: auto; }
            .table-section-card { padding: 15px; }
            .table-section-card .head h1, .table-section-card .head h3 { font-size: 18px;}
        }
    </style>
</head>
<body>

<div id="app-container">

    <section id="sidebar">
        <a th:href="@{/}" class="brand">
            <i class='bx bxs-drink'></i>
            <span class="text">B&S</span>
        </a>
        <ul class="side-menu top">
            <li> 
                <a th:href="@{/usuario/panel-barra(id=${session.usuariosession.id})}">
                    <i class='bx bxs-chalkboard'></i>
                    <span class="text">Dashboard Cristalería</span>
                </a>
            </li>
            <li>
                 <a th:href="@{/usuario/panel-insumos(id=${session.usuariosession.id})}">
                    <i class='bx bxs-flask'></i>
                    <span class="text">Dashboard Insumos</span>
                </a>
            </li>
            <li class="active"> <a th:href="@{/usuario/panel-barra(id=${session.usuariosession.id})}"> 
                    <i class='bx bx-slider-alt'></i>
                    <span class="text">Administrar Barra</span>
                </a>
            </li>
            <li>
                <a th:href="@{/usuario/editar-perfil(id=${session.usuariosession.id})}"> <i class='bx bx-plus-circle'></i>
                    <span class="text">Nueva Barra</span>
                </a>
            </li>
            <li>
                <a th:href="@{/usuario/editar-barra(id=${session.usuariosession.id})}"> <i class='bx bx-plus-circle'></i>
                    <span class="text">Crear Cristalería</span>
                </a>
            </li>
            <li>
                <a th:href="@{/usuario/editar-ruptura(id=${session.usuariosession.id})}">
                    <i class='bx bx-error-alt'></i>
                    <span class="text">Nueva Ruptura</span>
                </a>
            </li>
            <li>
                <a th:href="@{/usuario/editar-proveedor(id=${session.usuariosession.id})}">
                    <i class='bx bxs-user-plus'></i>
                    <span class="text">Nuevo Proveedor</span>
                </a>
            </li>
            <li>
                <a th:href="@{/usuario/editar-cristal(id=${session.usuariosession.id})}">
                    <i class='bx bx-image-add'></i>
                    <span class="text">Subir Imagen Cristalería</span>
                </a>
            </li>
             <li>
                <a th:href="@{/usuario/editar-pedido(id=${session.usuariosession.id})}">
                    <i class='bx bx-cart-add'></i>
                    <span class="text">Nuevo Pedido</span>
                </a>
            </li>
        </ul>
        <ul class="side-menu">
            <li>
                <a th:href="@{/usuario/editar-perfil-nuevo(id=${session.usuariosession.id})}">
                    <i class='bx bxs-cog'></i>
                    <span class="text">Settings</span>
                </a>
            </li>
            <li class="logout">
                <a th:href="@{/logout}" th:if="${session.usuariosession != null}">
                    <i class='bx bxs-log-out-circle'></i>
                    <span class="text">Logout</span>
                </a>
            </li>
        </ul>
    </section>
    <section id="content">
        <nav>
            <i class='bx bx-menu'></i>
            <a href="#" class="nav-link" th:text="${barra != null ? 'Detalles de Barra: ' + barra.nombre : 'Detalles de Barra'}">Detalles de Barra</a>
            <form action="#">
                <div class="form-input">
                    <input type="search" placeholder="Buscar...">
                    <button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
                </div>
            </form>
            <input type="checkbox" id="switch-mode" hidden>
            <label for="switch-mode" class="switch-mode"></label>
            <a href="#" class="notification">
                <i class='bx bxs-bell'></i>
                 <span class="num" th:if="${notificaciones != null && notificaciones > 0}" th:text="${notificaciones}">0</span>
            </a>
            <a href="#" class="profile" th:if="${perfil != null && perfil.id != null}"> <img th:src="@{'/foto/usuario/' + ${perfil.id}}" alt="Foto de perfil">
            </a>
        </nav>
        <main>
            <a class="btn-dashboard-link" th:href="@{/usuario/panel-barra(id=${session.usuariosession.id})}">
                <i class='bx bx-arrow-back'></i> Volver al Panel de Barras
            </a>

            <div th:if="${exito != null}" class="success-alert">
                <h5 class="card-title">Éxito</h5>
                <p class="card-text" th:text="${exito}"></p>
            </div>
            
            <div class="table-section-card" th:if="${barra != null}">
                <div class="head">
                    <h1>Detalles de la Barra: <span th:text="${barra.nombre}">Nombre Barra</span></h1>
                    <a th:href="@{'/usuario/editar-nombre-barra/' + ${barra.id}}" title="Editar Nombre Barra" class="action-icon">
                        <i class='fas fa-edit'></i>
                    </a>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Precio Total Estimado</th>
                            <th>Acciones</th> </tr>
                    </thead>
                    <tbody> 
                        <tr>
                            <td th:text="${barra.nombre}"></td>
                            <td th:text="${(barra.precioTotal ?: 0) + '$'}"></td>
                            <td>
                                <a th:href="@{/usuario/nueva-cristaleria-para-barra/__${barra.id}__}" title="Añadir Cristalería a esta Barra" class="action-icon">
                                    <i class="fas fa-plus-circle"></i> Añadir Cristalería
                                </a>
                                 </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div th:unless="${barra != null}" class="alert alert-warning" style="text-align:center;">No se encontraron detalles para la barra.</div>


            <div class="table-section-card" id="cristaleriasBarra">
                <div class="head">
                    <h3>Cristalerías en esta Barra</h3>
                    </div>
                <table>
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Stock</th>
                            <th>Descripción</th>
                            <th>Precio Unit.</th>
                            <th>Imagen</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody> 
                        <tr th:if="${#lists.isEmpty(cristalerias)}">
                            <td colspan="6" style="text-align:center;">No hay cristalerías asignadas a esta barra.</td>
                        </tr>
                        <tr th:each="cristaleria : ${cristalerias}">
                            <td th:text="${cristaleria.tipo}"></td>
                            <td th:text="${cristaleria.enStock}"></td>
                            <td th:text="${cristaleria.descripcion}"></td>
                            <td th:text="${(cristaleria.precio ?: 0) + '$'}"></td>
                            <td>
                                <img th:if="${cristaleria.id != null}" class="img-fluid" th:src="@{'/foto/cristaleriafoto/' + ${cristaleria.id}}" alt="Foto Cristalería">
                                </td>
                            <td>
                                <a th:href="@{/usuario/registrar-ruptura-cristaleria/__${cristaleria.id}__}" title="Registrar Ruptura" class="action-icon">
                                    <i class="fas fa-heart-broken"></i> </a>
                                <a th:href="@{/usuario/editar-cristaleria/__${cristaleria.id}__}" title="Editar Cristalería" class="action-icon">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="table-section-card" id="rupturasBarra">
                <div class="head">
                    <h3>Rupturas Recientes</h3>
                    </div>
                <table>
                    <thead>
                        <tr>
                            <th>Cristalería</th>
                            <th>Cantidad Rota</th>
                            <th>Costo Total</th>
                            <th>Explicación</th>
                            <th>Responsable</th>
                            <th>Fecha</th>
                            <th>Imagen</th>
                        </tr>
                    </thead>
                    <tbody> 
                        <tr th:if="${#lists.isEmpty(rupturas)}">
                            <td colspan="7" style="text-align:center;">No hay rupturas registradas para esta barra.</td>
                        </tr>
                        <tr th:each="ruptura : ${rupturas}">
                            <td th:text="${ruptura.tipoCristaleria.tipo}"></td>
                            <td th:text="${ruptura.numeroDeRuptura}"></td>
                            <td th:text="${(ruptura.costoRuptura ?: 0) + '$'}"></td>
                            <td th:text="${ruptura.explicacion}"></td>
                            <td th:text="${ruptura.nombre}"></td>
                            <td th:text="${ruptura.dia + '/' + ruptura.mes + '/' + ruptura.anio}"></td>
                            <td>
                                <img th:if="${ruptura.tipoCristaleria.id != null}" class="img-fluid" th:src="@{'/foto/cristaleriafoto/' + ${ruptura.tipoCristaleria.id}}" alt="Foto Cristalería Rota">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </main>
        </section>
    </div> <script th:src="@{/js/script.js}"></script>
</body>
</html>