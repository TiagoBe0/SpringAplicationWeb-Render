<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    
    <link rel="icon" type="image/svg+xml" th:href="@{/img/rahip-logo-blanco.svg}" />

    <title>BartenderStock - Registrar Ruptura</title>

    <style>
        /* ESTILOS GENERALES Y RESET (Idénticos a los dashboards anteriores) */
        :root {
            --primary-color: #6f42c1;
            --primary-color-darker: #5a34a7;
            --secondary-color: blueviolet;
            --light-grey: #f3f3f3;
            --dark-grey: #333;
            --text-color-light: #ffffff;
            --text-color-dark: #333333;
            --sidebar-bg: #4e2a8e;
            --content-bg: #f9f9f9;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
            --input-bg: #ffffff;
            --input-border: #ccc;
            --button-primary-bg: #6f42c1;
            --button-primary-text: #ffffff;
            --button-primary-hover-bg: #5a34a7;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background-color: var(--primary-color); color: var(--text-color-dark); overflow-x: hidden; }
        a { text-decoration: none; color: var(--primary-color-darker); }
        a:hover { color: var(--secondary-color); }
        img { max-width: 100%; height: auto; }

        /* --- ESTRUCTURA PRINCIPAL (Idéntica) --- */
        #app-container { display: flex; min-height: 100vh; }

        /* --- SIDEBAR (Idéntico) --- */
        #sidebar {
            background: var(--sidebar-bg); color: var(--text-color-light); width: 280px;
            position: fixed; top: 0; left: 0; height: 100%; overflow-y: auto;
            z-index: 1000; transition: width 0.3s ease;
        }
        #sidebar.hide { width: 60px; }
        #sidebar.hide .text, #sidebar.hide .brand .text { display: none; }
        #sidebar.hide .brand i, #sidebar.hide .side-menu a i { margin-right: 0; }
        #sidebar .brand {
            font-size: 24px; font-weight: 700; height: 64px; display: flex;
            align-items: center; justify-content: center; color: var(--text-color-light);
            padding: 0 10px; gap: 10px;
        }
        #sidebar .brand .bx { min-width: 40px; display: flex; justify-content: center; align-items: center; font-size: 28px; }
        #sidebar .side-menu { list-style: none; padding: 0; margin: 0; width: 100%; }
        #sidebar .side-menu a {
            display: flex; align-items: center; padding: 12px 20px;
            color: var(--text-color-light); font-size: 16px; white-space: nowrap;
            border-left: 3px solid transparent; transition: background 0.3s ease, border-left-color 0.3s ease;
        }
        #sidebar .side-menu a:hover, #sidebar .side-menu li.active > a {
            background: var(--primary-color-darker); border-left-color: var(--secondary-color);
        }
        #sidebar .side-menu a .bx { margin-right: 15px; font-size: 20px; min-width: 20px; text-align: center; }
        #sidebar .side-menu .logout a { color: #f36d6d; }
        #sidebar .side-menu .logout a:hover { background: #c83a3a; color: white; }

        /* --- ÁREA DE CONTENIDO (Idéntica) --- */
        #content {
            position: relative; width: calc(100% - 280px); margin-left: 280px;
            transition: width 0.3s ease, margin-left 0.3s ease;
            background-color: var(--content-bg); min-height: 100vh; padding-bottom: 20px;
        }
        #sidebar.hide + #content { width: calc(100% - 60px); margin-left: 60px; }

        /* NAVBAR SUPERIOR (Idéntica) */
        #content nav {
            height: 64px; background: var(--card-bg); padding: 0 24px;
            display: flex; align-items: center; gap: 24px; position: sticky;
            top: 0; z-index: 900; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        #content nav .bx.bx-menu { cursor: pointer; font-size: 24px; color: var(--text-color-dark); }
        #content nav .nav-link { color: var(--text-color-dark); font-size: 16px; }
        #content nav form { flex-grow: 1; margin-right: auto; }
        #content nav .form-input {
            display: flex; align-items: center; background: var(--light-grey);
            border-radius: 20px; overflow: hidden; max-width: 350px;
        }
        #content nav .form-input input {
            border: none; background: transparent; padding: 10px 15px;
            outline: none; width: 100%; color: var(--text-color-dark);
        }
        #content nav .form-input .search-btn {
            background: var(--primary-color); color: white; border: none; padding: 0 12px;
            height: 36px; border-radius: 0 20px 20px 0; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        #content nav .form-input .search-btn .bx { font-size: 18px; }
        #content nav .switch-mode {
            display: block; min-width: 50px; height: 25px; background: var(--light-grey);
            cursor: pointer; position: relative; border-radius: 25px;
        }
        #content nav .switch-mode::before {
            content: ''; position: absolute; top: 2px; left: 2px; bottom: 2px;
            width: calc(25px - 4px); background: var(--primary-color);
            border-radius: 50%; transition: all .3s ease;
        }
        #content nav #switch-mode:checked + .switch-mode::before { left: calc(100% - (25px - 4px) - 2px); }
        #content nav .notification, #content nav .profile img { font-size: 20px; color: var(--text-color-dark); position: relative; }
        #content nav .notification .num {
            position: absolute; top: -6px; right: -6px; width: 20px; height: 20px;
            border-radius: 50%; background: #e74c3c; color: white; font-weight: 700;
            font-size: 10px; display: flex; justify-content: center; align-items: center;
        }
        #content nav .profile img { width: 36px; height: 36px; object-fit: cover; border-radius: 50%; border: 2px solid var(--primary-color); }

        /* --- MAIN CONTENT AREA --- */
        #content main { padding: 24px; width: 100%; }
        .form-container-card {
            background-color: var(--card-bg); padding: 30px 40px; border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); max-width: 650px; /* Ancho ajustado */
            margin: 20px auto;
        }
        .form-container-card h2 {
            text-align: center; color: var(--text-color-dark); margin-bottom: 25px;
            font-size: 24px; font-weight: 600;
        }
        .form-input-group { margin-bottom: 20px; }
        .form-input-group label {
            display: block; font-size: 14px; color: #555;
            margin-bottom: 8px; font-weight: 500;
        }
        .form-input-group .form-control,
        .form-input-group .form-select { /* Aplicar a select también */
            width: 100%; padding: 12px 20px; border-radius: 25px;
            border: 1px solid var(--input-border); background-color: var(--input-bg);
            color: var(--text-color-dark); font-size: 16px; outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-input-group .form-control::placeholder { color: #aaa; }
        .form-input-group .form-control:focus,
        .form-input-group .form-select:focus {
            border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(111, 66, 193, 0.2);
        }
        
        .btn-submit-form {
            display: block; width: 100%; padding: 12px 30px; border-radius: 25px;
            border: none; background-color: var(--button-primary-bg);
            color: var(--button-primary-text); font-size: 16px; font-weight: bold;
            cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease;
            text-transform: uppercase; margin-top: 20px;
        }
        .btn-submit-form:hover { background-color: var(--button-primary-hover-bg); transform: translateY(-2px); }
        .btn-dashboard-link {
            display: inline-block; background: var(--secondary-color); color: white;
            padding: 10px 20px; border-radius: 20px; font-weight: 600;
            margin-bottom: 20px; transition: background-color 0.3s ease;
        }
        .btn-dashboard-link:hover { background: var(--primary-color-darker); color: white; }
        .btn-dashboard-link .bx { margin-right: 8px; vertical-align: middle; }


        /* RESPONSIVIDAD (Idéntica) */
        @media screen and (max-width: 768px) {
            #sidebar { width: 60px; }
            #sidebar .text, #sidebar .brand .text { display: none; }
            #sidebar .brand i, #sidebar .side-menu a i { margin-right: 0; }
            #content { width: calc(100% - 60px); margin-left: 60px; }
            #content nav .form-input { display: none; }
        }
        @media screen and (max-width: 576px) {
            #content nav .nav-link { display:none; }
            #content nav .profile { margin-left: auto; }
            .form-container-card { padding: 20px; }
        }

    </style>
</head>
<body>

<div id="app-container">

    <section id="sidebar">
        <a th:href="@{/usuario/panel-barra(id=${session.usuariosession.id})}" class="brand">
            <i class='bx bxs-drink'></i>
            <span class="text">B&S</span>
        </a>
        <ul class="side-menu top">
            <li> 
                <a th:href="@{/usuario/panel-barra(id=${session.usuariosession.id})}">
                    <i class='bx bxs-chalkboard'></i>
                    <span class="text">Dashboard Cristalería</span>
                </a>
            </li>
             <li>
                 <a th:href="@{/usuario/panel-insumos(id=${session.usuariosession.id})}">
                    <i class='bx bxs-flask'></i>
                    <span class="text">Dashboard Insumos</span>
                </a>
            </li>
            <li>
                <a th:href="@{/usuario/panel-barra(id=${session.usuariosession.id})}">
                    <i class='bx bx-slider-alt'></i>
                    <span class="text">Administrar Barra</span>
                </a>
            </li>
            <li>
                <a th:href="@{/usuario/editar-perfil(id=${session.usuariosession.id})}">
                    <i class='bx bx-plus-circle'></i>
                    <span class="text">Nueva Barra</span>
                </a>
            </li>
            <li>
                <a th:href="@{/usuario/editar-barra(id=${session.usuariosession.id})}">
                    <i class='bx bx-plus-circle'></i>
                    <span class="text">Crear Cristalería</span>
                </a>
            </li>
            <li class="active"> <a th:href="@{/usuario/editar-ruptura(id=${session.usuariosession.id})}">
                    <i class='bx bx-error-alt'></i>
                    <span class="text">Nueva Ruptura</span>
                </a>
            </li>
             <li>
                <a th:href="@{/usuario/editar-proveedor(id=${session.usuariosession.id})}">
                    <i class='bx bxs-user-plus'></i>
                    <span class="text">Nuevo Proveedor</span>
                </a>
            </li>
            <li>
                <a th:href="@{/usuario/editar-cristal(id=${session.usuariosession.id})}">
                    <i class='bx bx-image-add'></i>
                    <span class="text">Subir Imagen Cristalería</span>
                </a>
            </li>
        </ul>
        <ul class="side-menu">
            <li>
                <a th:href="@{/usuario/editar-perfil-nuevo(id=${session.usuariosession.id})}">
                    <i class='bx bxs-cog'></i>
                    <span class="text">Settings</span>
                </a>
            </li>
            <li class="logout">
                <a th:href="@{/logout}" th:if="${session.usuariosession != null}">
                    <i class='bx bxs-log-out-circle'></i>
                    <span class="text">Logout</span>
                </a>
            </li>
        </ul>
    </section>
    <section id="content">
        <nav>
            <i class='bx bx-menu'></i>
            <a href="#" class="nav-link">Gestión de Inventario</a>
            <form action="#">
                <div class="form-input">
                    <input type="search" placeholder="Buscar...">
                    <button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
                </div>
            </form>
            <input type="checkbox" id="switch-mode" hidden>
            <label for="switch-mode" class="switch-mode"></label>
            <a href="#" class="notification">
                <i class='bx bxs-bell'></i>
                <span class="num" th:if="${notificaciones != null && notificaciones > 0}" th:text="${notificaciones}">0</span>
            </a>
            <a href="#" class="profile" th:if="${perfil != null && perfil.id != null}">
                <img th:src="@{'/foto/usuario/' + ${perfil.id}}" alt="Foto de perfil">
            </a>
        </nav>
        <main>
            <a class="btn-dashboard-link" th:href="@{/usuario/panel-barra(id=${session.usuariosession.id})}">
                <i class='bx bx-arrow-back'></i> Volver al Dashboard
            </a>

            <div class="form-container-card">
                <h2>Registrar Nueva Ruptura</h2>
                <div th:if="${error}" class="alert alert-danger" style="background-color: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; margin-bottom:15px;">
                    <p th:text="${error}"></p>
                </div>
                <div th:if="${param.success}" class="alert alert-success" style="background-color: #d4edda; color: #155724; padding: 10px; border-radius: 5px; margin-bottom:15px;">
                    <p>Ruptura registrada con éxito.</p>
                </div>

                <form th:action="@{/usuario/actualizar-ruptura}" method="POST" enctype="multipart/form-data">
                    <input type="hidden" name="id" th:value="${perfil?.id}"/>

                    <div class="form-input-group">
                        <label for="nombreResponsable">Nombre del Responsable</label>
                        <input class="form-control" type="text" name="nombre" id="nombreResponsable" placeholder="Ej: Juan Pérez" required>
                    </div>

                    <div class="form-input-group">
                        <label for="explicacionRuptura">Explicación (Opcional)</label>
                        <input class="form-control" type="text" name="explicacion" id="explicacionRuptura" placeholder="Detalles del incidente">
                    </div>

                    <div class="form-input-group">
                        <label for="unidadesPerdidas">Unidades Perdidas</label>
                        <input class="form-control" type="number" name="cantidad" id="unidadesPerdidas" placeholder="0" required min="1">
                    </div>

                    <div class="form-input-group">
                       <label >Tipo de Cristaleria Rota</label>
  <select class="form-select" name="idCristaleria"> 
      <option th:each="cristaleria: ${cristalerias}" th:value="${cristaleria.id}" th:text="${cristaleria.tipo+'-'+cristaleria.barraPerteneciente.nombre}"  ></option>
      </select>
                    </div>
                    
                    <button class="btn-submit-form" type="submit">Registrar Ruptura</button>
                </form>
            </div>
        </main>
        </section>
    </div> <script th:src="@{/js/script.js}"></script>
</body>
</html>